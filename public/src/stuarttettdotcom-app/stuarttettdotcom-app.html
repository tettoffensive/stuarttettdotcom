<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="skew-style-module.html">
<link rel="import" href="skew-header.html">
<link rel="import" href="skew-card.html">
<link rel="import" href="skew-info-card.html">
<link rel="import" href="scatter-shapes.html">
<link rel="import" href="stuarttettdotcom-app.html">
<link rel="import" href="full-card.html">
<link rel="import" href="stt-close-btn.html">
<link rel="import" href="stt-scroll-btn.html">

<dom-module id="stuarttettdotcom-app">
  <template>
    <style include="skew-style-module">
    :host {
      display: block;
    }

    .wrapper {
      margin: auto;
      margin-top: 100px;
      /* width: 800px; */
      width: calc(100% - 16px);
      max-width: 1024px;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
    }

    .wrapper > * {
      margin: 0px;
      margin-bottom: 16px;
    }

    .shapes {
      position: fixed;
      width: 100%;
      height: 120%;
      left: 0;
    }

    .one {
      top: 0;
    }
  }
  </style>
  <scatter-shapes class="shapes one"></scatter-shapes>
  <div id="page" class="page">
    <div id="wrapper" class="wrapper">
      <skew-header></skew-header>
      <!-- <skew-info-card description="Stuart has a unique background with a double major in Art &amp; Design and Computer Science, which give way to a rare skill-set of strong visual and analytical problem-solving skills."></skew-info-card> -->
      <template is="dom-repeat" id="thecards" items="{{cards}}" on-dom-change="_cardsDomChange">
        <skew-card id=[[item.link]] link=[[item.link]] title=[[item.title]]
        description=[[item.description]]
        img=[[item.image]]
        on-click="_onClick"
        on-close="_onClickClose"></skew-card>
      </template>
    </div>
  </div>
</template>

<script>
"use strict"
/**
* @customElement
* @polymer
*/
class StuarttettdotcomApp extends Polymer.Element {
  static get is() { return 'stuarttettdotcom-app'; }
  static get properties() {
    return {
      detail: {type: String, value: '', reflectToAttribute: true, observer: '_detailChanged' },
      cards: {
        type: Array,
        value() {
          return [
            {type: 'skew-card',
            description: 'Created a logo for an online community platform for “makers” in the D.I.Y. community.',
            title: 'BuildUp.tv',
            image:'/images/buildup_mockup.jpg',
            link: 'builduptv',
          },

          // {type: 'skew-card',
          // description: 'Created a warm and respectful logo for an institute for couples therapy.',
          // title: 'Jewish EFT Institute',
          // image:'',
          // link: ''},
          //
          // {type: 'skew-card',
          // description: 'Designed a label for a craft beer aimed at customers who typically prefer easy-drinking beers',
          // title: 'Big Sissy Lager',
          // image:'/',
          // link: ''},
          //
          // {type: 'skew-card',
          // description: '',
          // title: '',
          // image:'',
          // link: ''},
        ];}
      }
    }
  }

  constructor(name) {
    super();
    this._lastClickElement = null;
  }

  ready() {
    super.ready();
  }

  _cardsDomChange(event) {
    if (this.detail) {
      this._updateDetailFor(this.detail);
    }
  }

  connectedCallback() {
    super.connectedCallback();
  }

  disconnectedCallback() {
    super.disconnectedCallback();
  }

  _onClick(event) {

    if (this._lastClickElement != null) {
      return;
    }

    let el = event.target;
    this._lastClickElement = el;
    // let model = this.$.thecards.modelForElement(el);
    el.openCard(event, (label, content) => {
      // el.detail = "true";
      // Page history
      document.title = "BuildUp.tv";
      history.pushState(null, "Stuart Tett - BuildUp.tv", "builduptv");
      // label.style.visibility = "hidden";
      // content.style.visibility = "hidden";
    });

  }

  _detailChanged(newValue, oldValue) {
    // console.log("changed");
    // if (newValue) {
    //   console.log("here " + this.$.thecards);
    //   let el = this.shadowRoot.querySelector('#builduptv');
    //   if (!el) {return;}
    //   console.log("element: " + el);
    //   let model = this.$.thecards.modelForElement(el);
    //   if (!model) {return;}
    //   console.log("model: " + model);
    //   model.detail = "true";
    // }
  }

  _updateDetailFor(newValue) {
    window.requestAnimationFrame(() => {
      let el = this.shadowRoot.querySelector('skew-card[link="' + newValue + '"]');
      let model = this.$.thecards.modelForElement(el);
      if (!model) {
        return;
      }
      el.transitioning = true; // transition to open
      el.tryCardAnimation(true).play("scaleUpContentFinish", false);

      model.detail = "true";
      this._lastClickElement = el;
    });
  }

  _onClickClose(event) {
    if (this._lastClickElement == null) {
      return;
    }
    let el = this._lastClickElement;
    this._lastClickElement = null;
    // let model = this.$.thecards.modelForElement(el);
    el.detail = "false";
    el.closeCard(event, (label, content) => {
      // Page history
      document.title = "Stuart Tett | Design & Code";
      history.pushState(null, document.title, "");
      label.style.visibility = "hidden";
      content.style.visibility = "hidden";
    });

  }
}

window.customElements.define(StuarttettdotcomApp.is, StuarttettdotcomApp);
</script>
</dom-module>
